#!/usr/bin/env node
var path      = require('path');
var fs        = require('fs');
var minimist  = require('minimist');
var xcss      = require('../index');
var compile   = require('../compiler');

var argv = minimist(process.argv, {boolean: ['c', 'compile', 'h', 'help']});

if (argv.help|| argv.h) {
  usage();
  process.exit(0);
}

var arg = argv._[2];
var file = arg;

if (!file || !fs.existsSync(file)) {
  usage();
  error('provide a filename as an argument');
}

file = path.resolve(file);

if (argv.compile || argv.c) {
  console.log(compile(fs.readFileSync(file, 'utf8')));
} else {
  var stylesheet = require(file);
  if (stylesheet.type === 'module')
    error(arg + " is a parametrized module and can't generate CSS");
  console.log(stylesheet.toCSS());
}

function usage() {
  console.log(fs.readFileSync(path.join(__dirname, 'usage.txt'), 'utf8'));
}

function error(msg) {
  console.warn('error:', msg);
  process.exit(1);
}
